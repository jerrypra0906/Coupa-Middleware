PRODUCT REQUIREMENT DOCUMENT (PRD)Custom Middleware for COUPA ↔ SAP S/4HANA IntegrationKPN Downstream | 20261. Project OverviewKPN Downstream requires a custom-built middleware to integrate the COUPA e-Procurement system with SAP S/4HANA. This middleware will function as a secure, configurable, and scalable integration layer capable of handling API and SFTP/CSV-based data exchanges.The middleware will also include an Admin Web Portal, Integration Scheduler, Logging System, Error Handling, Dashboard Monitoring, and an Oracle database to store staging data and logs.2. Problem StatementCOUPA does not directly integrate with KPN's SAP S/4HANA instance, and the existing SAP team is unable to support all non-SAP integrations quickly.To maintain project speed and autonomy, a custom middleware solution is required.3. Goals & ObjectivesGoalsProvide a robust integration layer between COUPA ↔ SAP S/4HANA.Enable admins to fully configure integration frequency without coding.Offer complete transparency on integration performance & errors.Support both API and CSV/SFTP data exchange.Ensure secure, traceable, and reliable sync of operational procurement data.ObjectivesAutomate data sync between COUPA and SAP with configurable schedules.Build a unified system for log viewing, retry processing, and error diagnosis.Provide dashboards for monitoring integration health.Enable Oracle-based staging to improve reliability and auditability.Provide a UI-based administration panel for non-technical users.4. High-Level Architecture (Based on Your Image)ComponentsSAP S/4HANACommunicates using OData/API (outbound)Accepts inbound data using custom Z-Programs / IDoc / APICOUPASupports REST APISupports CSV via SFTPCustom Middleware (New System)API Client → Connects to SAP OData & COUPA APIsSFTP Client → Handles CSV import/exportScheduler → Timer-based runs for each moduleTransformation Engine → Mapping logic between COUPA ⇄ SAPError Engine → Captures line-level errorsAdmin WebsiteIntegration configurationLogs viewerRetry engineDashboard monitoringOracle Database (Staging Layer)Stores staging data (inbound & outbound)Stores logsStores error history5. In-Scope Integrations5.1 COUPA → SAP S/4HANASuppliersChart of AccountsCost CentersPurchase OrdersInvoicesPayments status updatesGoods Receipts (optional based on process)5.2 SAP → COUPAVendor masterMaterial/service masterPurchase ordersGR/IRPayment run results5.3 Supported Integration MethodsAPI → REST (JSON/XML)CSV → SFTP6. Functional Requirements6.1 Middleware Admin Web Portal6.1.1 AuthenticationAdmin login (username + password)Role-based accessAdminView-onlyIntegration Operator6.2 Integration SchedulerRequirementsAdmin can configure:Integration frequency (every 5m, 15m, 30m, hourly, etc.)Integration time windowEnable/disable each integration moduleAPI method vs CSV methodScheduler must support:Cron-based triggersManual triggerRetry trigger6.3 Integration Logging & MonitoringRequirementsStore logs in Oracle DBShow logs in UI table:Integration name (PO Sync, Invoice Sync, Vendor Sync, etc.)TimestampStatus: Success / Partial Success / FailedSuccess CountError CountDuration (ms)Logs must be searchable by:DateIntegration typeStatusPO number / Vendor number6.4 Error HandlingRequirementsCapture errors down to line item levelDisplay error with:Line NumberField NameError Message from SAP or COUPARaw PayloadAllow:Manual correctionRe-process single lineRe-process entire batch6.5 Dashboard MonitoringRequirementsDaily sync volume (items processed)Success rate (%)Error trend last 7 daysIntegration duration metricsTop recurring error categoriesQueue backlogAPI latencySFTP upload/download volumeVisual components:Line chartsPie chartsError tablesSLA gauge6.6 API Integration EngineRequirementsSupport REST JSON for COUPASupport OData/XML/API for SAPImplement mapping engine:JSON → Oracle tableOracle → JSONImplement rate-limiting controlImplement retry logic for:Network failureTimeout429 Too Many Requests6.7 SFTP/CSV Integration EngineRequirementsConnect to COUPA SFTP locationDownload CSV filesValidate structure (column count, header match)Parse with error handlingUpload outbound CSV files to COUPA SFTP6.8 Oracle DatabaseRequired Tables:Staging tables (per module)LogsError logsIntegration configurationRetry queueAudit trail7. Non-Functional RequirementsPerformanceMust process 10,000 line items under 2 minutes.SecurityHTTPSToken-based auth for APIsPassword encryptionAudit trailsScalabilityAble to integrate new modules in future with minimal development.Availability99.5% uptime8. User RolesRoleResponsibilitiesAdminFull access, config scheduling, view logs, retryIntegration OperatorMonitor logs, run retriesViewerDashboard only9. Success KPIsKPITargetSync success rate≥ 98%Error resolution time≤ 24 hoursIntegration latency< 5 seconds per API callScheduler reliability99% on-time runsManual retries reduced80% reduction in month 2Dashboard accuracy100% alignment with DB logs10. Risk & MitigationRiskMitigationHigh dependency on SAP teamUse OData + Z-program templates earlyAPI limit on COUPAImplement rate limit + batchingData mismatchDevelop mapping validation engineCSV format changesSchema validation layerSecurity breachToken rotation + IP whitelist6.9 Email Notification Engine (New Requirement)ObjectiveEnsure that any integration error is immediately communicated to relevant stakeholders so corrective actions can be taken without delay.6.9.1 Email Notification Trigger ConditionsThe middleware must automatically send an email notification under the following conditions:Integration Failed (Status = FAIL)Error occurs at batch levelAPI or SFTP connection failureTimeoutMapping failurePartial Success (Status = PARTIAL)Some line items succeededSome items failed and need manual interventionHigh Severity ErrorMissing mandatory fields (e.g., Vendor Code, PO Number)SAP posting errorCOUPA validation errorOracle staging errorSystem-level failureScheduler fails to triggerDatabase connection issueAuthentication token expired6.9.2 Email Content RequirementsEvery error email must contain:Integration Name (e.g., PO Sync, Invoice Sync, Vendor Sync)Timestamp of runExecution Status (Failed / Partial)Total Records ProcessedNumber of ErrorsError Summary Table:Line NumberField NameError MessageDirect link to:Log detail page in Admin UIRetry buttonSubject Line Format:[COUPA-SAP Integration] ERROR – <Integration Name> – <Timestamp>6.9.3 Admin Configuration RequirementsA new Email Settings page shall be added to the Admin Portal.Admins must be able to configure:Recipient List (add/remove email addresses)Multiple groups (IT Ops, Purchasing, COUPA Admin, SAP Team)Notification type:Critical onlyCritical + PartialAll logsToggle notifications (ON / OFF) per integration moduleTest Email ButtonSMTP or API email provider credentials:SMTP HostPortSecurity Type (TLS/SSL)UserPassword6.9.4 Email Frequency ControlTo avoid spam:If the same error repeats within X minutes, send only 1 email (configurable).Provide digest mode:ImmediateEvery 30 minutes1-hour digestDaily summary8. Updated User RolesRoleNewly Added ResponsibilitiesAdminConfigure email settings, set recipients, manage notification rulesIntegration OperatorReceive error notifications, perform root cause checksViewerReceive summary-only notifications (optional)9. Updated Success KPIsKPITargetEmail delivery success rate100%Time to notify error< 60 seconds after integration runReduction of unreported failures90% reduction within Month 1Accuracy of email error details100% correct error mappingTime to resolve errors due to faster alerts50% improvement10. Updated Risks & MitigationRiskMitigationEmail spamming due to recurring errorsImplement suppression window + digest modeWrong recipients receiving alertsAdmin-managed recipient listEmail server downtimeAllow fallback to alternative SMTP or email APINotification delaysQueue-based email dispatchingSensitive data exposureMask critical values in email bodyIf you want, I can also:✅ Add this to the full PRD document✅ Generate UI wireframes for the Email Configuration Page✅ Create sample email templates✅ Provide UAT test scenariosJust say “yes please update PRD” or tell me what else you need.
